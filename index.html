<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>GothamBank</title>
</head>
<body>
    <div class="wrapper">
        <form action="">
            <h1>SignIn</h1>
            <div class="input-box">
                <input type="text" placeholder="Username">
                <i class='bx bxs-user'></i>
            </div>
            <div class="input-box">
                <input type="password" placeholder="password">
                <i class='bx bxs-lock-alt'></i>
            </div>
            
            <div class="pin-wrapper">
              <input type="password" maxlength="1" class="pin-input">
              <input type="password" maxlength="1" class="pin-input">
              <input type="password" maxlength="1" class="pin-input">
              <input type="password" maxlength="1" class="pin-input">
          </div>

            <div class="input-box" >
                <input type="email" placeholder="email">
            </div>
            <button class="btn" type="submit">SignIn</button>
        </form>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.querySelector("form");
  const pinInputs = document.querySelectorAll(".pin-input");

  // Auto movement + backspace logic
  pinInputs.forEach((input, index) => {
    input.addEventListener("input", () => {
      if (input.value.length === 1 && index < pinInputs.length - 1) {
        pinInputs[index + 1].focus();
      }
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && input.value === "" && index > 0) {
        pinInputs[index - 1].focus();
      }
    });
  });

  // Helper function to collect PIN
  const getPIN = () => {
    return Array.from(pinInputs).map(i => i.value).join("");
  };

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const inputs = form.querySelectorAll("input");

    const userName = inputs[0].value.trim();
    const password = inputs[1].value.trim();
    const email = inputs[6].value.trim(); // Since 4 PIN inputs exist in between

    const pin = getPIN();

    if (pin.length !== 4) {
      alert("Please enter a 4-digit PIN");
      return;
    }

    const body = { 
      userName, 
      password, 
      balance: 0.0, 
      roles: "CUSTOMER", 
      email,
      pin
    };

    try {
      const res = await fetch("http://localhost:8080/public/create-user", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (res.ok) {
        alert("User registered successfully!");
        window.location.href = "login.html";
      } else {
        const msg = await res.text();
        alert("Registration failed: " + msg);
      }
    } catch (err) {
      alert("Error: " + err.message);
    }
  });
});
</script>


</body>
</html>